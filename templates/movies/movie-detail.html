{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="movie-detail-container container mt-4">
  <!-- Movie Header (Poster + Details) -->
  <div class="movie-header row">
    <!-- Poster Column -->
    <div class="col-md-4 text-center">
      <img src="{{ movie.poster_url }}"
           class="movie-detail-poster img-fluid rounded"
           alt="{{ movie.title }} poster"
           onerror="this.src='{% static 'images/no_poster.png' %}'">
    </div>

    <!-- Details Column -->
    <div class="col-md-8">
      <h1 class="movie-detail-title">{{ movie.title }}</h1>
        <div class="movie-rating">
            {% if movie.average_rating %}
                <div class="rating-badge">
                    ⭐ {{ movie.average_rating|floatformat:"0" }}/10
                </div>
                <small>{{ movie.reviews.count }} review/s</small>
            {% else %}
                <div class="no-rating">
                    No ratings yet
                </div>
            {% endif %}
        </div>
      <div class="movie-meta">
        <p><strong>Director:</strong> {{ movie.director }}</p>
        <p><strong>Release Date:</strong> {{ movie.release_date|date:"F j, Y" }}</p>
        <p><strong>Cast:</strong> {{ movie.cast|default:"Not specified" }}</p>
      </div>
      <div class="movie-description mt-3">
        <h3>Synopsis</h3>
        <p>{{ movie.description }}</p>
      </div>
    </div>
  </div>

  <!-- Reviews Section -->
  <div class="movie-reviews mt-5">
    <h2 class="border-bottom pb-2">Reviews</h2>

    {% for review in movie.reviews.all %}
      <div class="movie-review-card card mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <h5 class="card-title">{{ review.author.username }}</h5>
            <span class="movie-review-rating">★ {{ review.rating }}/10</span>
          </div>
          <p class="card-text">{{ review.content }}</p>
          <small class="text-muted">
            {{ review.created_at|date:"M d, Y" }}
          </small>
        </div>
      </div>
    {% empty %}
      <p class="text-muted">No reviews yet.</p>
    {% endfor %}

    <!-- Review Form -->
    {% if user.is_authenticated %}
      <div class="movie-review-form mt-4">
        {% if user_review %}
          <a href="{% url 'review-edit' user_review.id %}"
             class="btn">
            ✏️ Edit Your Review
          </a>
        {% else %}
          <h3>Add Your Review</h3>
          <form method="post" action="{% url 'add-review' movie.id %}" class="mt-3">
            {% csrf_token %}
            <div class="mb-3">
              <label class="form-label">Rating (1-10)</label>
              {{ review_form.rating }}
            </div>
            <div class="mb-3">
              <label class="form-label">Review</label>
              {{ review_form.content }}
            </div>
            <button type="submit" class="btn">Submit</button>
          </form>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}