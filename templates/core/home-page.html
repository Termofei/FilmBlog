{% extends 'core/base.html' %}
{% load static %}
{% block content %}
<main>
  <div class="container">
    <!-- Search Bar -->
    <form class="searchbar mb-4">
      <input type="text"
             id="movie-search"
             placeholder="Search movies by title or director..."
             aria-label="Search movies">
      <button type="button">
        <i class="bi bi-search"></i>
      </button>
    </form>

    <!-- Movie List -->
    <div class="movie-list">
      {% for movie in movies %}
        <div class="movie-card"
             data-search="{{ movie.title|lower }} {{ movie.director|lower }}">
          <img src="{{ movie.poster_url }}" alt="{{ movie.title }}" class="movie-poster">
          <div class="movie-info">
            <h3>{{ movie.title }}</h3>
              <div class="card-rating">
                    {% if movie.average_rating %}
                        ⭐ {{ movie.average_rating|floatformat:"0" }}/10
                    {% endif %}
                </div>
            <p>{{ movie.director }} • {{ movie.release_date|date:"Y" }}</p>
            <a href="{% url 'movie-detail' movie.id %}" class="btn btn-primary">Details</a>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- JavaScript Searchbar Logic -->
    <script>
      function performSearch() {
        const searchInput = document.getElementById('movie-search');
        const searchTerm = searchInput.value.toLowerCase();
        const cards = document.querySelectorAll('.movie-card');

        cards.forEach(card => {
          const matches = card.dataset.search.includes(searchTerm);
          card.classList.toggle('hidden', !matches);
        });
      }

      // Search on button click
      document.querySelector('.searchbar button').addEventListener('click', performSearch);

      // Search on Enter key
      document.getElementById('movie-search').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault(); // Prevent form submission
          performSearch();
        }
      });
    </script>

    <!-- Pagination (Simplified) -->
    {% if is_paginated %}
      <div class="pagination">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
            &laquo; Previous
          </a>
        {% endif %}
        
        <span class="current">
          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
            Next &raquo;
          </a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</main>
{% endblock %}